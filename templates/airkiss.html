<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="maximum-scale=1.0, minimum-scale=1.0, user-scalable=0, initial-scale=1.0, width=device-width" />
    <meta name="format-detection" content="telephone=no, email=no, date=no, address=no">
    <title>调用微信接口页面-airkiss</title>
    <style>
    </style>
</head>

<body>
    <div>即将自动跳转。。。</div>
    <input type="hidden" value="{{ tdata["url"] }}" id="signedstr" />
</body>
<script src="http://res2.wx.qq.com/open/js/jweixin-1.6.0.js"></script>
<script src="https://cdn.staticfile.org/jquery/1.10.2/jquery.min.js"></script>
<script type="text/javascript">
var xhr = new XMLHttpRequest();
xhr.open('GET', 'http://www.mrbutfly.com/wx/sign');
xhr.send(null);
xhr.onload = function(e) {
    if (xhr.status === 200) {
        sign=JSON.parse(xhr.responseText)

         var signedstr = $("#signedstr").val();

        wx.config({
            beta: true, //开启内测接口调用，注入wx.invoke方法
            debug: false, //关闭调试模式
            appId: sign['appId'], //AppID
            timestamp: sign['timestamp'], //时间戳
            nonceStr: sign['nonceStr'], //随机串
            signature: sign['signature'], //js-sdk签名
            jsApiList: [
                // 所有要调用的 API 都要加到这个列表中
                'checkJsApi',
                'onMenuShareTimeline',//
                'onMenuShareAppMessage',
                'onMenuShareQQ',
                'onMenuShareWeibo'
            ]
        });


        <!--window.share_config = {-->
         <!--"share": {-->
            <!--"imgUrl": "http://www.yourwebsite.com/share.png",//分享图，默认当相对路径处理，所以使用绝对路径的的话，“http://”协议前缀必须在。-->
            <!--"desc" : "你对页面的描述",//摘要,如果分享到朋友圈的话，不显示摘要。-->
            <!--"title" : '分享卡片的标题',//分享卡片标题-->
            <!--"link": window.location.href,//分享出去后的链接，这里可以将链接设置为另一个页面。-->
            <!--"success":function(){//分享成功后的回调函数-->
            <!--},-->
            <!--'cancel': function () {-->
                <!--// 用户取消分享后执行的回调函数-->
            <!--}-->
        <!--}-->
        <!--};-->


        wx.ready(function() {
            // 在这里调用 API
            //wx.invoke('configWXDeviceWiFi');

            <!--wx.onMenuShareAppMessage(share_config.share);//分享给好友-->
            <!--wx.onMenuShareTimeline(share_config.share);//分享到朋友圈-->
            <!--wx.onMenuShareQQ(share_config.share);//分享给手机QQ-->

            <!--wx.onMenuShareTimeline({-->
                <!--title: '编程课程-火箭发射 ', // 分享标题-->
                <!--link: window.location.href,     //分享的url,以http或https开头-->
                <!--imgUrl: "http://hwcdncx.3dbutfly.com/createx_pc/Picture/c_05.png",           // 分享图标-->
            <!--});-->


            wx.onMenuShareAppMessage({
            title: '编程课程-火箭发射', // 分享标题
            desc: '火箭发射场景拼装，点火发射，代码编程，趣味教学。', // 分享描述
            link: "http://edu.3dbutfly.com:8080?url="+signedstr, // 分享链接
            imgUrl: 'http://hwcdncx.3dbutfly.com/createx_pc/Picture/c_05.png', // 分享图标
            //type: '', // 分享类型,music、video或link，不填默认为link
            //dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
            success: function () {
                // 用户确认分享后执行的回调函数
            },
            cancel: function () {
                // 用户取消分享后执行的回调函数
            }
            });



        });
        wx.error(function(res) {
            alert("配置出错");
        });
    } else {
        alert('请求签名失败！');
    }
}
xhr.onerror = function(e) {
    alert('请求失败'+e)
}
</script>

</html>